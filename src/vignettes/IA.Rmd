---
title: "IA"
author: "Daniela StÃ¤ngle"
output: pdf_document
vignette: >
  %\VignetteIndexEntry{IA}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, IA() setup, include = FALSE}
library(zeitreihen)

set.seed(742)
knitr::opts_chunk$set(
  collapse = TRUE,
  echo = TRUE,
  fig.height = 6,
  fig.width = 6,
  tidy = TRUE
)
```

## The Innovations Algorithm `IA()`
The Innovations Algorithm is a recursive algorithm that can be applied to stationary time series \( \{X_t\} \) with
zero-mean and finite second moments. The algorithm gives the coefficients of the one-step predictors \( \hat{X}_1, \hat{X}_2 \dots \), which can be calculated recursively once the coefficients have been determined.
Additionally, the algorithm calculates the mean squared errors \( \nu_i \).

### Basic Usage
To apply the algorithm to a time series X, we call the function `IA()` with parameter X. Every time we call upon the algorithm, a warning will be given that the user has to check if the time series is stationary.
```{r, IA() basic usage}
X <- stats::rnorm(5, mean = 0, sd = 1)
out <- IA(X)
```

As output, we get the vector `nu`, which contains the mean squared errors,
```{r, IA() nu output}
out$nu
```

the matrix \[
  \Theta_5 = \begin{pmatrix}
    0           & 0           & 0           & 0           & 0 \\
    \theta_{11} & 0           & 0           & 0           & 0 \\
    \theta_{22} & \theta_{21} & 0           & 0           & 0 \\
    \theta_{33} & \theta_{32} & \theta_{31} & 0           & 0 \\
    \theta_{44} & \theta_{43} & \theta_{42} & \theta_{41} & 0
  \end{pmatrix}
\]
```{r, IA() theta matrix outout}
out$theta
```

And the vector of coefficients, `coeffs` = \( \begin{pmatrix} \theta_{41} & \theta_{42} & \theta_{43} & \theta_{44} \end{pmatrix} \),
```{r, IA() coeffs output}
out$coeffs
```
Which can be used to calculate the one-step predictor \( \hat{X}_{5} \) via \
\[
  \hat{X}_{n} = \begin{cases} 0, & \text{if} n = 1, \\
  \sum\limits_{j=1}^{n-1} \theta_{n-1,j} (X_{n-j}-\hat{X}_{n-j}), & \text{if} n = 2, 3, 4, 5 \end{cases}
\]
For example, the coefficient \( \theta_{41} \) is the coefficient before the difference of the value of the time series \( \{X_t\} \) at time \( t = 4 \) and its predictor \( \hat{X_4} \).
\

What happens:

* It is checked if `X` and `max_lag` have the required format.
* Allocation of a numeric vector `nu` of length `max_lag` to store the mean square errors \(v_0,\dots, v_{max\_lag-1}\).
* Computation of the Autocovariances (\(\kappa(i,j)\) is equal to the Autocovariance of X with \(h=i-j\)) of the time series with `sample_ACVF(X,h)` for `h` from 0 to the biggest difference `max_lag`-1.
* Initializing by assigning \(v_0\) the Autocovariance for `h` equal zero and allocating a numeric matrix with `max_lag` rows and columns.
* Calculating the coefficient \(\theta_{11}\) and the mean squared error \(v_1\) separately. Afterward recursively calculating the coefficients \(\theta_{n, n - k}\) and \(v_k\) from \(k = 0\) to \(n - 1\) using the equation \[
  \theta_{n, n-k} = \nu_k^{-1} (\kappa(n+1, k+1) - \sum_{j=0}^{k-1} \theta_{k, k-j} \theta_{n, n-j} \nu_j), \quad 0 \leq k < n
\]
and \[
  \nu_n = \kappa(n+1, n+1) - \sum_{j=0}^{n-1} \theta_{n, n-j}^2 \nu_j
\]
\

Required Format:

* `X` is an atomic vector of length bigger one, which has numeric or complex values and can't contain NA, Inf or NaN values.
* `max_lag` must be an integer bigger one, can't be NA, Inf or NaN and can't be bigger than the length of `X`.


### Using the optional parameter `max_lag`
Additionally, the parameter `max_lag` (per default the length of the time series) can be set, to indicate till where the \( \theta \) 's should be calculated.
```{r, IA() parameter max_lag, warning = FALSE}
X <- stats::rnorm(100, mean = 0, sd = 1)
out <- IA(X, max_lag = 6)
out$nu
out$theta
```


### Requirements
Several inputs are not allowed. Here are a few examples of the error messages: \
\
If the time series contains values, which are `NaN` or `Inf`:
```{r, IA() time series error (value), error = TRUE}
X <- NaN + stats::rnorm(10, mean = 0, sd = 1)
Y <- c(0, 0, 0, Inf)
out <- IA(Y)
out <- IA(X)
```
\
If the time series contains values, which are not numeric or complex values:
```{r, IA() time series error (value format), error = TRUE}
X <- c("2.01", 1, 0)
out <- IA(X)
```
\
If the time series is not an atomic vector:
```{r, IA() time series error (format), error = TRUE}
X <- list(m = matrix(1, nrow = 10, ncol = 5), "test")
out <- IA(X)
```
\
If `max_lag` is smaller than 2, not an integer or bigger than the length of the time series:
```{r, IA() max_lag error, error = TRUE}
X <- stats::rnorm(10, 0, 1)
out <- IA(X, 1)
IA(X, 3.14)
IA(X, 51)
```
